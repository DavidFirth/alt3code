name: 'Test action'

# **What it does**: Renders the content of every page and check all internal links.
# **Why we have it**: To make sure all links connect correctly.
# **Who does it impact**: Docs content.

on:
  workflow_dispatch:

jobs:
  first-job:
    runs-on: ubuntu-latest
    env:
      SLACK_URL: ${{ secrets.SLACK_URL }}
      FDO_APIKEY: ${{ secrets.FDO_APIKEY }}
      ALT3_HOME: ${{ github.workspace }}/data
      ALT3_CODE: ${{ github.workspace }}/code/pkg
      ALT3_SCRIPTS: ${{ github.workspace }}/code/scripts
      ALT3_LEAGUES_DIR: ${{ github.workspace }}/data/docs/assets/leagues
      ALT3_CURRENT_SEASON: 2022
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        path: code
    - name: 'setup R'
      uses: r-lib/actions/setup-r@v2
    - name: 'setup R dependencies'
      uses: r-lib/actions/setup-r-dependencies@v2
      with:
        cache-version: 2
        working-directory: code/pkg
    - name: 'where we are'
      run: pwd
    - name: Checkout tools repo
      uses: actions/checkout@v3
      with:
        repository: DavidFirth/alt3
        path: data
    - name: 'where we are now'
      run: pwd
    - name: 'github workspace'
      run: echo ${{ github.workspace }}
    - name: 'test R'
      run: bash "$ALT3_SCRIPTS"/update-all.sh
    - name: 'push to github'
      run: Rscript "$ALT3_SCRIPTS"/push.R
